<script setup lang="ts">
/**
 * BrowserBreakdown Component
 *
 * Displays browser usage breakdown with icons.
 */
import { computed } from 'vue'
import type { TopItem } from '../types'
import { formatPercentage } from '../utils'

const props = withDefaults(defineProps<{
  browsers: TopItem[]
  loading?: boolean
}>(), {
  loading: false,
})

const browserIcons: Record<string, string> = {
  chrome: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C8.21 0 4.831 1.757 2.632 4.501l3.953 6.848A5.454 5.454 0 0 1 12 6.545h10.691A12 12 0 0 0 12 0zM1.931 5.47A11.943 11.943 0 0 0 0 12c0 6.012 4.42 10.991 10.189 11.864l3.953-6.847a5.45 5.45 0 0 1-6.865-2.29zm13.342 2.166a5.446 5.446 0 0 1 1.45 7.09l.002.001h-.002l-3.952 6.848a12.014 12.014 0 0 0 9.229-9.006zM12 16.364a4.364 4.364 0 1 1 0-8.728 4.364 4.364 0 0 1 0 8.728z"/></svg>`,
  firefox: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M8.824 7.287c.008 0 .004 0 0 0zm-2.8-1.4c.006 0 .003 0 0 0zm16.754 2.161c-.505-1.215-1.53-2.528-2.333-2.943.654 1.283 1.033 2.57 1.177 3.53l.002.02c-1.314-3.278-3.544-4.6-5.366-7.477-.091-.147-.184-.292-.273-.446a3.545 3.545 0 0 1-.13-.24 2.118 2.118 0 0 1-.172-.46.03.03 0 0 0-.027-.03.038.038 0 0 0-.021 0l-.006.001-.006.001-.008.001c-2.044 1.193-2.734 3.393-2.8 4.494a3.946 3.946 0 0 0-2.18.825 2.364 2.364 0 0 0-.203-.148 3.687 3.687 0 0 1-.07-1.959 5.706 5.706 0 0 0-1.89 1.458 3.95 3.95 0 0 0-.67-.063c-.014 0-.027-.001-.04-.001l-.062-.02a3.26 3.26 0 0 1-.07-.672c0-.453.057-.888.164-1.296l-.005-.006c-.396.224-.75.504-1.048.828a8.39 8.39 0 0 1-.107-.292c-.052-.154-.101-.31-.146-.466l-.029-.095-.052-.155c-.063-.2-.118-.4-.165-.604l-.017-.075-.002-.021-.003-.022-.002-.015-.003-.015-.002-.011-.001-.005a9.063 9.063 0 0 0-.166-.557l-.087-.214c-.162-.403-.37-.79-.62-1.147a8.478 8.478 0 0 0-1.09-1.303l-.055-.051a7.224 7.224 0 0 0-.262-.225l-.02-.016-.014-.012a6.706 6.706 0 0 0-.48-.336c-.148-.095-.302-.185-.464-.272a6.485 6.485 0 0 0-.578-.265c-.081-.033-.166-.066-.254-.1-.1-.04-.201-.078-.306-.117-.1-.038-.204-.076-.309-.113l-.103-.037c-.101-.037-.204-.074-.309-.11-.11-.039-.222-.078-.335-.117-.058-.021-.117-.041-.177-.061l-.05-.018c-.1-.035-.2-.07-.302-.104l-.056-.02a8.72 8.72 0 0 0-.322-.106c-.111-.037-.223-.074-.336-.11a11.653 11.653 0 0 0-.341-.106l-.01-.003c-.116-.036-.233-.072-.35-.107-.12-.037-.24-.073-.36-.109l-.058-.017-.06-.018c-.111-.034-.223-.068-.335-.1-.114-.034-.228-.068-.343-.101l-.348-.1c-.118-.034-.236-.067-.354-.099l-.059-.016-.06-.017a8.758 8.758 0 0 0-.358-.095l-.06-.016c-.119-.031-.237-.062-.356-.092l-.06-.015-.06-.015c-.119-.03-.237-.059-.356-.087l-.12-.028-.06-.014c-.108-.025-.217-.05-.326-.074l-.11-.024-.11-.024a7.994 7.994 0 0 0-.323-.067l-.054-.011-.054-.01c-.107-.021-.214-.042-.321-.062l-.053-.01-.054-.01c-.107-.02-.214-.038-.32-.056l-.054-.009-.053-.009c-.106-.017-.211-.033-.316-.048l-.052-.007-.052-.007c-.105-.014-.209-.027-.313-.039l-.052-.006-.052-.005c-.103-.012-.206-.022-.308-.031l-.051-.005-.052-.004c-.102-.009-.203-.017-.303-.023l-.05-.003-.05-.003c-.1-.006-.199-.01-.298-.014l-.05-.002-.049-.001c-.098-.004-.196-.006-.293-.007h-.097c-.097 0-.194.002-.29.005l-.048.001-.048.002c-.096.003-.192.008-.287.014l-.048.003-.047.003c-.094.007-.188.015-.281.025l-.046.005-.046.005c-.093.01-.185.022-.277.035l-.045.006-.044.007c-.091.013-.182.028-.272.044l-.044.008-.044.008c-.089.017-.178.035-.266.054l-.043.01-.043.01c-.087.02-.174.042-.26.065l-.042.011-.042.012c-.085.024-.17.05-.253.076l-.041.013-.04.014c-.082.027-.164.056-.245.087l-.04.015-.039.015c-.08.031-.158.063-.236.097l-.038.016-.037.017c-.076.034-.152.07-.226.107l-.036.018-.036.018c-.073.037-.145.076-.216.117l-.035.02-.034.02c-.069.04-.138.082-.206.125l-.033.021-.033.022c-.066.043-.131.088-.195.134l-.031.023-.031.023c-.063.047-.124.095-.185.144l-.03.024-.029.024c-.059.049-.117.1-.174.153l-.027.025-.027.026c-.056.052-.11.106-.163.161l-.026.027-.025.027c-.052.055-.102.111-.152.169l-.024.027-.023.028c-.048.057-.094.116-.14.176l-.022.028-.021.029c-.044.06-.087.12-.129.182l-.02.029-.019.029c-.04.061-.078.124-.116.188l-.018.03-.017.03c-.036.063-.071.127-.105.192l-.016.03-.015.031c-.032.064-.063.129-.093.195l-.014.03-.013.031c-.029.065-.056.131-.082.198l-.012.031-.011.031c-.025.066-.049.133-.071.201l-.01.031-.009.031c-.021.067-.041.135-.06.204l-.008.031-.007.031c-.017.068-.034.136-.049.206l-.006.031-.005.032c-.014.068-.026.137-.038.207l-.004.031-.003.032c-.01.069-.019.138-.027.208l-.002.032-.002.032c-.006.069-.011.139-.015.21l-.001.031v.032c-.003.07-.004.14-.004.211v.063c0 .07.001.14.004.21v.031l.001.032c.004.07.009.14.015.21l.002.031.002.032c.008.07.017.139.027.208l.003.032.004.031c.012.07.024.139.038.208l.005.031.006.031c.015.07.032.138.049.207l.007.031.008.031c.019.069.039.137.06.204l.009.031.01.031c.022.068.046.135.071.201l.011.031.012.03c.026.067.053.133.082.199l.013.03.014.03c.03.066.061.131.093.195l.015.031.016.03c.034.065.069.129.105.192l.017.03.018.03c.038.064.076.127.116.188l.019.03.02.028c.042.062.085.122.129.182l.021.029.022.028c.046.06.092.119.14.176l.023.028.024.028c.05.058.1.114.152.169l.025.027.026.027c.053.055.107.109.163.161l.027.026.027.025c.057.053.115.104.174.153l.029.024.03.024c.061.049.122.097.185.144l.031.023.031.022c.064.046.129.091.195.135l.033.021.033.021c.068.043.137.085.206.125l.034.02.035.02c.071.041.143.08.216.117l.036.018.036.018c.074.037.15.073.226.107l.037.017.038.016c.078.034.156.066.236.097l.039.015.04.015c.081.031.163.06.245.087l.04.014.041.013c.083.026.168.052.253.076l.042.012.042.011c.086.023.173.045.26.065l.043.01.043.01c.088.019.177.037.266.054l.044.008.044.008c.09.016.181.031.272.044l.044.007.045.006c.092.013.184.025.277.035l.046.005.046.005c.093.01.187.018.281.025l.047.003.048.003c.095.006.191.011.287.014l.048.002.048.001c.096.003.193.005.29.005h.097c.097-.001.195-.003.293-.007l.049-.001.05-.002c.099-.004.198-.008.298-.014l.05-.003.05-.003c.1-.006.201-.014.303-.023l.052-.004.051-.005c.102-.009.205-.019.308-.031l.052-.005.052-.006c.104-.012.208-.025.313-.039l.052-.007.052-.007c.105-.015.21-.031.316-.048l.053-.009.054-.009c.106-.018.213-.036.32-.056l.054-.01.053-.01c.107-.02.214-.041.321-.062l.054-.01.054-.011c.106-.022.214-.044.323-.067l.11-.024.11-.024c.109-.024.218-.049.326-.074l.06-.014.12-.028c.119-.028.237-.057.356-.087l.06-.015.06-.015c.119-.03.237-.061.356-.092l.06-.016c.119-.031.239-.063.358-.095l.06-.017.059-.016c.118-.032.236-.065.354-.099l.348-.1c.115-.033.229-.067.343-.101.112-.032.224-.066.335-.1l.06-.018.058-.017c.12-.036.24-.072.36-.109.117-.035.234-.071.35-.107l.01-.003c.114-.033.227-.068.341-.106.113-.036.225-.073.336-.11.108-.036.214-.071.322-.106l.056-.02c.101-.034.201-.069.302-.104l.05-.018c.06-.02.119-.04.177-.061.113-.039.225-.078.335-.117.105-.036.208-.073.309-.11l.103-.037c.105-.037.209-.075.309-.113.105-.039.206-.077.306-.117.088-.034.173-.067.254-.1.193-.08.385-.168.578-.265.162-.087.316-.177.464-.272.163-.106.323-.217.48-.336l.014-.012.02-.016c.088-.071.175-.147.262-.225l.055-.051c.375-.357.735-.803 1.09-1.303.25-.357.458-.744.62-1.147l.087-.214c.058-.166.114-.353.166-.557l.001-.005.002-.011.003-.015.002-.015.003-.022.002-.021.017-.075c.047-.204.102-.404.165-.604l.052-.155.029-.095c.045-.156.094-.312.146-.466.036-.1.072-.196.107-.292.298-.324.652-.604 1.048-.828l.005.006c-.107.408-.164.843-.164 1.296 0 .229.024.453.07.672l.062.02c.013 0 .026.001.04.001.228.001.453.024.67.063a5.706 5.706 0 0 1 1.89-1.458 3.687 3.687 0 0 0 .07 1.959c.063.053.132.102.203.148a3.946 3.946 0 0 1 2.18-.825c.066-1.101.756-3.301 2.8-4.494l.008-.001.006-.001.006-.001a.038.038 0 0 1 .021 0 .03.03 0 0 1 .027.03c.04.152.1.308.172.46.04.08.082.16.13.24.089.154.182.299.273.446 1.822 2.877 4.052 4.199 5.366 7.477l-.002-.02c-.144-.96-.523-2.247-1.177-3.53.803.415 1.828 1.728 2.333 2.943.742 1.775.955 3.597.675 5.336-1.084 7.155-8.08 11.17-14.524 10.33C3.22 23.007.213 17.37 1.635 11.17c.336-1.504.855-2.726 1.616-3.744.247.392.537.735.864 1.025a5.02 5.02 0 0 1-.123 1.403 6.2 6.2 0 0 1 1.636-1.48c-.127.662-.046 1.351.233 1.96.08.175.175.341.284.496a2.384 2.384 0 0 1 .66-.617 2.11 2.11 0 0 1-.142-.686c-.007-.153.003-.306.028-.458.015-.1.037-.197.065-.293.055-.186.137-.362.243-.523.098-.148.212-.286.34-.41a5.44 5.44 0 0 1 .775-.612c.297-.196.623-.35.969-.46a3.949 3.949 0 0 1 1.14-.17h.031a3.94 3.94 0 0 1 1.14.169c.346.11.672.264.969.46.263.173.513.377.775.612.128.124.242.262.34.41.106.161.188.337.243.523.028.096.05.193.065.293.025.152.035.305.028.458a2.11 2.11 0 0 1-.142.686 2.384 2.384 0 0 1 .66.617c.109-.155.204-.321.284-.496.279-.609.36-1.298.233-1.96a6.2 6.2 0 0 1 1.636 1.48 5.02 5.02 0 0 1-.123-1.403c.327-.29.617-.633.864-1.025z"/></svg>`,
  safari: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 24C5.373 24 0 18.627 0 12S5.373 0 12 0s12 5.373 12 12-5.373 12-12 12zm0-2c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zm-1.276-4.768l-.246-.612 5.852-9.606.474.114-5.852 9.606-.228.498zm-.448-1.116l-.978-2.434 2.992-4.912 2.928.706-2.992 4.912-1.95-2.272zm7.504-9.9l-.614.246-1.544 2.536-2.928-.706 1.544-2.536.498-.228.612.246 2.432.442zm-11.56 11.56l.246.612-1.544 2.536-.498.228-.612-.246-2.432-.442.614-.246 1.544-2.536.498-.228.612.246 1.572.076zm.448 1.116l.978 2.434-.498.228-.612-.246-2.432-.442.614-.246 1.95 2.272zM12 5.5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1zm-6.5 6a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zm13 0a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zM12 18.5a.5.5 0 1 1 0 1 .5.5 0 0 1 0-1z"/></svg>`,
  edge: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M21.86 17.86q.14 0 .25.12.1.13.1.25t-.11.33l-.32.46-.43.53-.44.5q-.21.25-.38.42l-.22.23q-.58.53-1.34 1.04-.76.51-1.6.91-.86.4-1.74.64t-1.67.24q-.9 0-1.69-.28-.8-.28-1.48-.78-.68-.5-1.22-1.17-.53-.66-.92-1.44-.38-.77-.6-1.63-.2-.85-.2-1.73 0-1.17.27-2.26.28-1.1.8-2.08.51-.98 1.23-1.82.71-.83 1.61-1.48.9-.65 1.94-1.06 1.05-.41 2.2-.54l.14-.02q.14 0 .27.07t.2.2q.08.13.08.28 0 .15-.08.28-.14.22-.34.42-.2.2-.42.39-.22.18-.44.35l-.42.3q-.2.14-.37.25-.17.12-.28.19l-.14.09q-.12.07-.27.13-.14.06-.3.1-.16.05-.34.07-.18.02-.37.02-1.02 0-1.87.44-.84.43-1.45 1.15-.6.72-.95 1.66-.34.94-.34 1.99 0 1.24.4 2.26.4 1.02 1.07 1.75.68.73 1.55 1.13.88.4 1.82.4 1.15 0 2.14-.38 1-.39 1.83-.99.84-.6 1.5-1.32t1.13-1.41q.09-.13.21-.18.12-.05.25-.05z"/></svg>`,
  opera: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M8.51 7.04C9.44 5.57 10.67 4.62 12 4.62s2.56.95 3.49 2.42c.66.97 1.16 2.15 1.48 3.48.27 1.15.42 2.42.42 3.76s-.15 2.61-.42 3.76c-.32 1.33-.82 2.51-1.48 3.48-.93 1.47-2.16 2.42-3.49 2.42s-2.56-.95-3.49-2.42c-.66-.97-1.16-2.15-1.48-3.48-.27-1.15-.42-2.42-.42-3.76s.15-2.61.42-3.76c.32-1.33.82-2.51 1.48-3.48zM12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0z"/></svg>`,
  other: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/></svg>`,
}

const browserColors: Record<string, string> = {
  chrome: 'bg-yellow-100 text-yellow-600',
  firefox: 'bg-orange-100 text-orange-600',
  safari: 'bg-blue-100 text-blue-600',
  edge: 'bg-cyan-100 text-cyan-600',
  opera: 'bg-red-100 text-red-600',
  other: 'bg-gray-100 text-gray-600',
}

const sortedBrowsers = computed(() => [...props.browsers].sort((a, b) => b.value - a.value))

function getBrowserIcon(name: string): string {
  const key = name.toLowerCase()
  return browserIcons[key] || browserIcons.other
}

function getBrowserColor(name: string): string {
  const key = name.toLowerCase()
  return browserColors[key] || browserColors.other
}
</script>

<template>
  <div class="browser-breakdown">
    <h3 class="text-sm font-medium text-gray-900 mb-4">
      Browsers
    </h3>

    <!-- Loading state -->
    <div v-if="loading" class="space-y-4">
      <div v-for="i in 4" :key="i" class="animate-pulse flex items-center gap-4">
        <div class="skeleton w-10 h-10 rounded-lg" />
        <div class="flex-1">
          <div class="skeleton h-4 w-20 mb-2" />
          <div class="skeleton h-2 w-full" />
        </div>
      </div>
    </div>

    <!-- Empty state -->
    <div v-else-if="!browsers.length" class="text-center py-8 text-gray-500">
      No browser data available
    </div>

    <!-- Browser list -->
    <div v-else class="space-y-4">
      <div
        v-for="browser in sortedBrowsers"
        :key="browser.name"
        class="flex items-center gap-4"
      >
        <div
          class="w-10 h-10 rounded-lg flex items-center justify-center"
          :class="getBrowserColor(browser.name)"
          v-html="getBrowserIcon(browser.name)"
        />
        <div class="flex-1">
          <div class="flex items-center justify-between">
            <span class="font-medium text-gray-900 capitalize">{{ browser.name }}</span>
            <span class="text-sm text-gray-600">{{ formatPercentage(browser.percentage) }}</span>
          </div>
          <div class="progress-bar mt-1">
            <div
              class="progress-fill bg-gray-400"
              :style="{ width: `${browser.percentage * 100}%` }"
            />
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<style scoped>
.browser-breakdown {
  @apply card-hover p-6;
}
</style>
