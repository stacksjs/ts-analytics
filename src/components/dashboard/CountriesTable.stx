<script>
/**
 * CountriesTable Component
 * Displays countries with flag and visitor count
 */
const countries = state($props.countries || [])
const loading = state($props.loading || false)

effect(() => {
  if ($props.countries) countries.set($props.countries)
  if ($props.loading !== undefined) loading.set($props.loading)
})

// Simple country code to flag emoji converter
function getFlag(name) {
  const countryFlags = {
    'United States': 'ğŸ‡ºğŸ‡¸', 'United Kingdom': 'ğŸ‡¬ğŸ‡§', 'Germany': 'ğŸ‡©ğŸ‡ª', 'France': 'ğŸ‡«ğŸ‡·',
    'Canada': 'ğŸ‡¨ğŸ‡¦', 'Australia': 'ğŸ‡¦ğŸ‡º', 'Japan': 'ğŸ‡¯ğŸ‡µ', 'China': 'ğŸ‡¨ğŸ‡³',
    'India': 'ğŸ‡®ğŸ‡³', 'Brazil': 'ğŸ‡§ğŸ‡·', 'Netherlands': 'ğŸ‡³ğŸ‡±', 'Spain': 'ğŸ‡ªğŸ‡¸',
    'Italy': 'ğŸ‡®ğŸ‡¹', 'Russia': 'ğŸ‡·ğŸ‡º', 'South Korea': 'ğŸ‡°ğŸ‡·', 'Mexico': 'ğŸ‡²ğŸ‡½',
    'Indonesia': 'ğŸ‡®ğŸ‡©', 'Poland': 'ğŸ‡µğŸ‡±', 'Sweden': 'ğŸ‡¸ğŸ‡ª', 'Switzerland': 'ğŸ‡¨ğŸ‡­'
  }
  return countryFlags[name] || 'ğŸŒ'
}
</script>

<div class="table-container">
  <table class="data-table">
    <thead>
      <tr>
        <th class="text-left">Country</th>
        <th class="text-right">Visitors</th>
      </tr>
    </thead>
    <tbody>
      <tr @if="loading()">
        <td colspan="2" class="loading-cell">Loading...</td>
      </tr>
      <tr @if="!loading() && countries().length === 0">
        <td colspan="2" class="empty-cell">No location data</td>
      </tr>
      <tr @for="country in countries()" @if="!loading()">
        <td class="name">
          <span class="flag">{{ getFlag(country.name ? country.name : country.code) }}</span>
          {{ country.name ? country.name : (country.code ? country.code : 'Unknown') }}
        </td>
        <td class="value">{{ (country.visitors ? country.visitors : 0) | fmt }}</td>
      </tr>
    </tbody>
  </table>
</div>

<style>
.table-container {
  overflow-x: auto;
}
.data-table {
  width: 100%;
  font-size: 0.8125rem;
}
.data-table th {
  padding: 0.5rem 0;
  font-size: 0.6875rem;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--muted);
  border-bottom: 1px solid var(--border);
}
.data-table td {
  padding: 0.5rem 0;
  border-bottom: 1px solid var(--border);
}
.data-table td.name {
  display: flex;
  align-items: center;
  gap: 6px;
}
.data-table td.value {
  text-align: right;
  font-variant-numeric: tabular-nums;
}
.loading-cell,
.empty-cell {
  text-align: center;
  color: var(--muted);
  padding: 1rem 0;
}
.flag {
  font-size: 1rem;
}
.text-left { text-align: left; }
.text-right { text-align: right; }
</style>
